# VM Snapshot - 2026-01-01_201819

## monitor-backend (repo na VM)
- path: /home/questar/monitor-backend
- branch: main
- sha: 2dd18e8e1b5cc6f95784ca3597564793b7fd58ea

### git status -sb
## main...origin/main
 M dist/routes/adminRoutes.js
 M dist/ws/wsClient.js
 M dist/ws/wsFrame.js
 M src/ws/wsClient.ts
 M src/ws/wsFrame.ts
 M tools/sb_run_vm.js
?? -H
?? -d
?? dist/routes/workerSessionTokenRoutes.js

## systemd worker (status resumido)
● monitor-schemebuilder-worker.service - Worker SchemeBuilder - monitor-backend
   Loaded: loaded (/etc/systemd/system/monitor-schemebuilder-worker.service; enabled; vendor preset: enabled)
  Drop-In: /etc/systemd/system/monitor-schemebuilder-worker.service.d
           └─10-env-and-dns.conf, 10-render.conf, 10-worker-tokenpull.conf, 10-worker.conf, 20-ws-timeout.conf, 20-ws-timeouts.conf, 21-timeouts-15s.conf, 30-allow-remote.conf, 40-ws-guid.conf, 50-sb-encode.conf, 99-jobserver.conf
   Active: active (running) since Thu 2026-01-01 20:05:20 -03; 13min ago
 Main PID: 11228 (node)
    Tasks: 11 (limit: 2319)
   CGroup: /system.slice/monitor-schemebuilder-worker.service
           └─11228 node dist/worker/schemeBuilderWorker.js

jan 01 20:12:38 Tunel env[11228]: Node.js v20.19.6
jan 01 20:12:44 Tunel env[11228]: [worker] poll /api/jobs/next: 204 (sem job)
jan 01 20:12:52 Tunel env[11228]: [worker] poll /api/jobs/next: 204 (sem job)
jan 01 20:13:06 Tunel env[11228]: [worker] poll /api/jobs/next: 204 (sem job)
jan 01 20:13:26 Tunel env[11228]: [worker] poll /api/jobs/next: 204 (sem job)
jan 01 20:14:00 Tunel env[11228]: [worker] poll /api/jobs/next: 204 (sem job)
jan 01 20:14:53 Tunel env[11228]: [worker] poll /api/jobs/next: 204 (sem job)
jan 01 20:15:54 Tunel env[11228]: [worker] poll /api/jobs/next: 204 (sem job)
jan 01 20:16:55 Tunel env[11228]: [worker] poll /api/jobs/next: 204 (sem job)
jan 01 20:17:55 Tunel env[11228]: [worker] poll /api/jobs/next: 204 (sem job)

## systemd worker (paths — sem conteúdo sensível)
FragmentPath=/etc/systemd/system/monitor-schemebuilder-worker.service
DropInPaths=/etc/systemd/system/monitor-schemebuilder-worker.service.d/10-env-and-dns.conf /etc/systemd/system/monitor-schemebuilder-worker.service.d/10-render.conf /etc/systemd/system/monitor-schemebuilder-worker.service.d/10-worker-tokenpull.conf /etc/systemd/system/monitor-schemebuilder-worker.service.d/10-worker.conf /etc/systemd/system/monitor-schemebuilder-worker.service.d/20-ws-timeout.conf /etc/systemd/system/monitor-schemebuilder-worker.service.d/20-ws-timeouts.conf /etc/systemd/system/monitor-schemebuilder-worker.service.d/21-timeouts-15s.conf /etc/systemd/system/monitor-schemebuilder-worker.service.d/30-allow-remote.conf /etc/systemd/system/monitor-schemebuilder-worker.service.d/40-ws-guid.conf /etc/systemd/system/monitor-schemebuilder-worker.service.d/50-sb-encode.conf /etc/systemd/system/monitor-schemebuilder-worker.service.d/99-jobserver.conf

## last logs (últimas 40 linhas, com redaction)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
Stopping Worker SchemeBuilder - monitor-backend...
Stopped Worker SchemeBuilder - monitor-backend.
Started Worker SchemeBuilder - monitor-backend.
[worker] Iniciando. JOB_SERVER_BASE_URL=https://monitor-backend-1pm8.onrender.com, WORKER_ID=vm-worker-01
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] Job recebido: id=d05a0b061be60803, vehicleId=1940478
[worker] Processando job d05a0b061be60803 (vehicleId=1940478)...
[worker] Erro no job d05a0b061be60803: [sb_run_vm] exit=1
/home/questar/monitor-backend/tools/sb_run_vm.js:530
        return reject(new Error(
                      ^
Error: WS error action_value=403 desc="action forbidden" seen=1 parsed=1 parseErr=0 lastRaw="{"action_value":"403","error_description":"action forbidden"}" lastSent="" lastFrame="associate_vehicles_actions_opr {"client_id":218572,"client_name":"TransLima","vehicle_id":1940478,"action_id":1,"action_source":0,"vehicle_setting_id":5592,"comment":"test job after ws encode patch [JOB:d05a0b061be60803]"}"
    at Timeout.<anonymous> (/home/questar/monitor-backend/tools/sb_run_vm.js:530:23)
    at listOnTimeout (node:internal/timers:581:17)
    at process.processTimers (node:internal/timers:519:7)
Node.js v20.19.6
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
[worker] poll /api/jobs/next: 204 (sem job)
